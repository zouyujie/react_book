"use strict";!function(h,t){var e,c=h.className("left"),a=h.className("center"),l=h.className("right"),s=h.className("page"),n=h.className("page-left"),o=h.className("page-center"),v=h.className("navbar-left"),g=h.className("navbar-center"),i=h.className("page-shadow"),r=h.className("transitioning"),d="."+c,f="."+a,m="."+l,p=h.classSelector(".icon"),u=h.classSelector(".navbar"),N=h.classSelector(".navbar-inner"),b=h.classSelector(".pages"),y=h.classSelector(".btn-nav"),P="."+n,_="."+o,L="."+v,S="."+g,k=h.Class.extend({init:function(t,e){this.view=this.element=t,this.options=h.extend({animateNavbar:!0,swipeBackPageActiveArea:30,hardwareAccelerated:!0},e),this.navbars=this.view.querySelector(u),this.pages=this.view.querySelector(b),this.history=[],this.maxScrollX=this.view.offsetWidth,this.x=this.y=0,this.translateZ=this.options.hardwareAccelerated?" translateZ(0)":"",this.ratio=0,this.isBack=!0,this.moved=this.dragging=!1,this.activeNavbar=this.previousNavbar=null,this.activePage=this.previousPage=null,this._initPageEventMethod(),this._initDefaultPage(),this._initNavBar(),this.initEvent()},_initPageEventMethod:function(){var i=this;h.each(["onPageBeforeShow","onPageShow","onPageBeforeBack","onPageBack"],function(t,s){i[s+"Callbacks"]={},i[s]=function(t,e){var a=s+"Callbacks";i[a].hasOwnProperty(t)?i[a][t].push(e):i[a][t]=[e]}})},_initDefaultPage:function(){var t=document.querySelector(this.options.defaultPage);if(!t)throw new Error("defaultPage["+this.options.defaultPage+"] does not exist");this._appendPage(t)},initEvent:function(){this.view.addEventListener("click",this),this.view.addEventListener("tap",this),this.pages.addEventListener("drag",this),this.pages.addEventListener("dragend",this),this.pages.addEventListener("webkitTransitionEnd",this)},handleEvent:function(t){switch(t.type){case"click":this._click(t);break;case"tap":this._tap(t);break;case"drag":this._drag(t);break;case"dragend":this._dragend(t);break;case"webkitTransitionEnd":this._webkitTransitionEnd(t)}},shadow:(e=document.createElement("div"),e.className=i,e),_removePage:function(t,e){this._removeNavbar(t,e),document.body.appendChild(t),this._cleanPageClass(t)},_prependPage:function(t){var e=t.querySelector(N);this._prependNavbar(e),t.classList.add(n),this.pages.insertBefore(t,this.pages.firstElementChild)},_appendPage:function(t){var e=t.querySelector(N);this._appendNavbar(e),t.classList.add(o),this.pages.appendChild(t)},_removeNavbar:function(t,e){t.insertBefore(e,t.firstElementChild),this._cleanNavbarClass(e)},_prependNavbar:function(t){t.classList.add(v),this.navbars.insertBefore(t,this.navbars.firstElementChild)},_appendNavbar:function(t){t.classList.add(g),this.navbars.appendChild(t)},_cleanPageClass:function(t){t.classList.remove(o),t.classList.remove(n)},_cleanNavbarClass:function(t){t.classList.remove(g),t.classList.remove(v)},_tap:function(t){for(var e=t.target;e&&e!==document;e=e.parentNode)if("A"===e.tagName&&e.hash){var a=document.getElementById(e.hash.replace("#",""));if(a&&a.classList.contains(s)){t.stopPropagation(),t.detail.gesture.preventDefault(),this.go(e.hash);break}}},_click:function(t){for(var e=t.target;e&&e!==document;e=e.parentNode)if("A"===e.tagName&&e.hash){var a=document.getElementById(e.hash.replace("#",""));if(a&&a.classList.contains(s)){t.preventDefault();break}}},_cleanStyle:function(t){t&&(t.style.webkitTransform="",t.style.opacity="")},_webkitTransitionEnd:function(t){if(this.dragging=this.moved=!1,this.activePage===t.target){this.isInTransition=!1,this.shadow.parentNode===this.activePage&&this.activePage.removeChild(this.shadow),this.previousPageClassList.remove(r),this.activePageClassList.remove(r);var a=this;if(h.os.ios&&this.options.animateNavbar&&this.previousNavElements&&this.activeNavElements){var s=this.isBack;h.each(this.previousNavElements,function(t,e){e.classList.remove(r),s&&a._cleanStyle(e)}),h.each(this.activeNavElements,function(t,e){e.classList.remove(r),a._cleanStyle(e)}),this.previousNavBackIcon&&(this.previousNavBackIcon.classList.remove(r),s&&this._cleanStyle(this.previousNavBackIcon)),this.activeNavBackIcon&&(this.activeNavBackIcon.classList.remove(r),this._cleanStyle(this.activeNavBackIcon))}else this.previousNavbar.classList.remove(r),this.activeNavbar.classList.remove(r),this._cleanStyle(this.previousNavbar),this._cleanStyle(this.activeNavbar);this._cleanStyle(this.previousPage),this._cleanStyle(this.activePage),this.ratio<=.5||(this.isBack?(this._removePage(this.activePage,this.activeNavbar),this.previousPageClassList.remove(n),this.previousPageClassList.add(o),this.previousNavbar.classList.remove(v),this.previousNavbar.classList.add(g),0<this.history.length&&this._prependPage(this.history.pop()),this._initNavBar(),this._trigger("pageBack",this.activePage),this._trigger("pageShow",this.previousPage)):(this.previousPageClassList.add(n),this.activePageClassList.add(o),this._trigger("pageShow",this.activePage)))}},_trigger:function(t,e){var a="on"+t.charAt(0).toUpperCase()+t.slice(1)+"Callbacks";if(this[a].hasOwnProperty(e.id))for(var s=this[a][e.id],i=new CustomEvent(t,{detail:{page:e},bubbles:!0,cancelable:!0}),r=s.length;r--;)s[r].apply(this,i);h.trigger(this.view,t,{page:e})},_initPageTransform:function(){return this.previousPage=this.pages.querySelector(P),this.activePage=this.pages.querySelector(_),!(!this.previousPage||!this.activePage)&&(this.activePage.appendChild(this.shadow),this.previousPageClassList=this.previousPage.classList,this.activePageClassList=this.activePage.classList,this.previousPageStyle=this.previousPage.style,this.activePageStyle=this.activePage.style,this.previousPageClassList.remove(r),this.activePageClassList.remove(r),this.options.animateNavbar&&this.navbars&&(this.previousNavbar=this.navbars.querySelector(L),this.activeNavbar=this.navbars.querySelector(S),this.previousNavbar&&this.activeNavbar&&(this.previousNavElements=this.previousNavbar.querySelectorAll(d+","+f+","+m),this.activeNavElements=this.activeNavbar.querySelectorAll(d+","+f+","+m),this.previousNavBackIcon=this.previousNavbar.querySelector(d+y+" "+p),this.activeNavBackIcon=this.activeNavbar.querySelector(d+y+" "+p))),this.x=0,this.dragging=!0)},_initNavBar:function(){if(this.options.animateNavbar&&this.navbars)for(var t,e,a,s,i,r,n,o,h,c,l,v=this.navbars.querySelectorAll(N),g=0,p=v.length;g<p;g++){e=(t=v[g]).querySelector(d),a=t.querySelector(m),s=t.querySelector(f),o=!e,noRight=!a,i=o?0:e.offsetWidth,r=noRight?0:a.offsetWidth,n=s?s.offsetWidth:0,l=this.maxScrollX,onLeft=t.classList.contains("navbar-left"),noRight&&(h=l-n),o&&(h=0),o||noRight||(h=(l-r-n+i)/2);var u=(l-n)/2;c=n<l-i-r?(u<i&&(u=i),l-r<u+n&&(u=l-r-n),u-h):0;s&&(s.style.marginLeft=-i+"px",s.mNavbarLeftOffset=30-(h+c),s.mNavbarRightOffset=l-h-c-n),onLeft&&(s.style.webkitTransform="translate3d("+s.mNavbarLeftOffset+"px, 0, 0)"),o||(e.mNavbarLeftOffset=-i,e.mNavbarRightOffset=(l-i)/2,onLeft&&(e.style.webkitTransform="translate3d("+e[0].mNavbarLeftOffset+"px, 0, 0)")),noRight||(a.mNavbarLeftOffset=-(l-r)/2,a.mNavbarRightOffset=r,onLeft&&(a.style.webkitTransform="translate3d("+a[0].mNavbarLeftOffset+"px, 0, 0)"))}},_drag:function(t){if(!this.isInTransition){var e=t.detail;if(this.dragging||e.start.x-this.view.offsetLeft<this.options.swipeBackPageActiveArea&&(this.isBack=!0,this._initPageTransform()),this.dragging){var a=0;this.moved?a=e.deltaX-e.lastDeltaX:(a=e.deltaX,h.gestures.touch.lockDirection=!0,h.gestures.touch.startDirection=e.direction);var s=this.x+a;(s<0||s>this.maxScrollX)&&(s=s<0?0:this.maxScrollX),t.stopPropagation(),e.gesture.preventDefault(),this.requestAnimationFrame||this._updateTranslate(),this.moved=!0,this.x=s,this.y=0}}},_dragend:function(t){if(this.moved){t.stopPropagation();t.detail;this._clearRequestAnimationFrame(),this._prepareTransition(),this.ratio=this.x/this.maxScrollX,1!==this.ratio&&0!==this.ratio?.5<this.ratio?this.setTranslate(this.maxScrollX,0):(this._cleanStyle(this.previousPage),this._cleanStyle(this.activePage)):h.trigger(this.activePage,"webkitTransitionEnd")}},_prepareTransition:function(){this.isInTransition=!0,this.previousPageClassList.add(r),this.activePageClassList.add(r);var a=this;this.options.animateNavbar&&this.previousNavElements&&this.activeNavElements&&(this.previousNavbar.classList.add(r),this.activeNavbar.classList.add(r),h.each(this.previousNavElements,function(t,e){e.classList.add(r),a._cleanStyle(e)}),h.each(this.activeNavElements,function(t,e){e.classList.add(r),a._cleanStyle(e)}),this.previousNavBackIcon&&(this._cleanStyle(this.previousNavBackIcon),this.previousNavBackIcon.classList.add(r)),this.activeNavBackIcon&&(this._cleanStyle(this.activeNavBackIcon),this.activeNavBackIcon.classList.add(r)))},_clearRequestAnimationFrame:function(){this.requestAnimationFrame&&(cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=null)},_getTranslateStr:function(t,e){return this.options.hardwareAccelerated?"translate3d("+t+"px,"+e+"px,0px) "+this.translateZ:"translate("+t+"px,"+e+"px) "},_updateTranslate:function(){var t=this;t.x===t.lastX&&t.y===t.lastY||t.setTranslate(t.x,t.y),t.requestAnimationFrame=requestAnimationFrame(function(){t._updateTranslate()})},_setNavbarTranslate:function(t,e){var a=t/this.maxScrollX;if(h.os.ios&&this.options.animateNavbar&&this.previousNavElements&&this.activeNavElements){var s,i,r;for(s=0,i=this.activeNavElements.length;s<i;s++)if((r=this.activeNavElements[s]).style.opacity=1-a*(r.classList.contains(c)?3.5:1.3),!r.classList.contains(l)){var n=a*r.mNavbarRightOffset;r.style.webkitTransform="translate3d("+n+"px,0,0)",r.classList.contains(c)&&this.activeNavBackIcon&&(this.activeNavBackIcon.style.webkitTransform="translate3d("+-n+"px,0,0)")}for(s=0,i=this.previousNavElements.length;s<i;s++)if((r=this.previousNavElements[s]).style.opacity=1.3*a-.3,!r.classList.contains(l)){var o=r.mNavbarLeftOffset*(1-a);r.style.webkitTransform="translate3d("+o+"px,0,0)",r.classList.contains(c)&&this.previousNavBackIcon&&(this.previousNavBackIcon.style.webkitTransform="translate3d("+-o+"px,0,0)")}}else this.activeNavbar.style.opacity=1-1.3*a,this.previousNavbar.style.opacity=1.3*a-.3},setTranslate:function(t,e){this.x=t,this.y=e,this.previousPage.style.opacity=.9+.1*t/this.maxScrollX,h.os.ios&&(this.previousPage.style.webkitTransform=this._getTranslateStr(t/5-this.maxScrollX/5,e)),this.activePage.style.webkitTransform=this._getTranslateStr(t,e),this.options.animateNavbar&&this._setNavbarTranslate(t,e),this.lastX=this.x,this.lastY=this.y},canBack:function(){return this.pages.querySelector(P)},back:function(){this.isInTransition||(this.isBack=!0,this.ratio=1,this._initPageTransform()&&(this._trigger("pageBeforeBack",this.activePage),this._trigger("pageBeforeShow",this.previousPage),this._prepareTransition(),this.previousPage.offsetHeight,this.activePage.offsetHeight,this.setTranslate(this.maxScrollX,0)))},go:function(t){if(!this.isInTransition){var e=document.querySelector(t);if(e){e.querySelector(N);var a=this.navbars.querySelector(L),s=this.navbars.querySelector(S),i=this.pages.querySelector(P),r=this.pages.querySelector(_);a&&i&&(this._removePage(i,a),this.history.push(i)),s&&(s.classList.remove(g),s.classList.add(v)),r&&(r.classList.remove(o),r.style.webkitTransform="translate3d(0,0,0)",r.classList.add(n)),e.style.webkitTransform="translate3d(100%,0,0)",this._appendPage(e),e.appendChild(this.shadow),e.offsetHeight,this.isBack=!1,this.ratio=1,this._initPageTransform(),this._initNavBar(),this._setNavbarTranslate(this.maxScrollX,0),this.previousPage.offsetHeight,this.activePage.offsetHeight,this.previousNavbar.offsetHeight,this.activeNavbar.offsetHeight,this._trigger("pageBeforeShow",this.activePage),this._prepareTransition(),this.setTranslate(0,0)}}}});h.fn.view=function(t){var e=this[0],a=null,s=e.getAttribute("data-view");return s?a=h.data[s]:(s=++h.uuid,h.data[s]=a=new k(e,t)),a}}(mui,window);