"use strict";!function(l,t){var e="ontouchstart"in document,c=e?"touchstart":"mousedown",s=e?"touchmove":"mousemove",h=e?"touchend":"mouseup",f=l.className("locker-holder"),o=l.className("locker");(t.querySelector("head")||t.querySelector("body")).innerHTML+="<style>.mui-locker-holder{overflow:hidden;position:relative;padding:0px;}.mui-locker-holder canvas{width:100%;height:100%;}</style>";function d(t){for(var e=t.offsetLeft,o=t.offsetParent;null!==o;)e+=o.offsetLeft,o=o.offsetParent;return e}function p(t){for(var e=t.offsetTop,o=t.offsetParent;null!==o;)e+=o.offsetTop,o=o.offsetParent;return e}var i=l.Locker=l.Class.extend({R:26,CW:400,CH:320,OffsetX:30,OffsetY:30,init:function(t,e){var o=this;if(!t)throw"构造 Locker 时缺少容器元素";if(o.holder=t,!o.holder.__locker_inited){o.holder.__locker_inited=!0,o.options=e||{},o.options.callback=o.options.callback||o.options.done||l.noop,o.holder.innerHTML="<canvas></canvas>",o.holder.classList.add(f);var n=o.canvas=l.qsa("canvas",o.holder)[0];n.on=n.addEventListener||function(t,e,o){n.attachEvent("on"+t,e,o)},n.off=n.removeEventListener||function(t,e,o){n.detachEvent("on"+t,e,o)},o.options.width&&(o.holder.style.width=o.options.width+"px"),o.options.height&&(o.holder.style.height=o.options.height+"px"),o.CW=o.options.width||o.holder.offsetWidth||o.CW,o.CH=o.options.height||o.holder.offsetHeight||o.CH,o.R*=4,o.CW*=4,o.CH*=4,o.OffsetX*=4,o.OffsetY*=4,n.width=o.CW,n.height=o.CH;var i=o.cxt=n.getContext("2d"),r=(o.CW-2*o.OffsetX-2*o.R*3)/2,a=(o.CH-2*o.OffsetY-2*o.R*3)/2;o.pointLocationArr=o.caculateNinePointLotion(r,a),o.initEvent(n,i,o.holder),o.draw(i,o.pointLocationArr,[],null),setTimeout(function(){o.draw(i,o.pointLocationArr,[],null)},0)}},caculateNinePointLotion:function(t,e){for(var o=this,n=[],i=0;i<3;i++)for(var r=0;r<3;r++){var a={X:o.OffsetX+r*t+(2*r+1)*o.R,Y:o.OffsetY+i*e+(2*i+1)*o.R};n.push(a)}return n},draw:function(t,e,o,n){var i=this,r=i.R;if(0<o.length){t.beginPath();for(var a=0;a<o.length;a++){var l=o[a];t.lineTo(e[l].X,e[l].Y)}if(t.lineWidth=8,t.strokeStyle=i.options.lineColor||"#999",t.stroke(),t.closePath(),null!=n){var c=e[o[o.length-1]];t.beginPath(),t.moveTo(c.X,c.Y),t.lineTo(n.X,n.Y),t.stroke(),t.closePath()}}for(a=0;a<e.length;a++){var s=e[a];t.fillStyle=i.options.ringColor||"#888",t.beginPath(),t.arc(s.X,s.Y,r,0,4*Math.PI,!0),t.closePath(),t.fill(),t.fillStyle=i.options.fillColor||"#f3f3f3",t.beginPath(),t.arc(s.X,s.Y,r-8,0,4*Math.PI,!0),t.closePath(),t.fill(),0<=o.indexOf(a)&&(t.fillStyle=i.options.pointColor||"#777",t.beginPath(),t.arc(s.X,s.Y,r-64,0,4*Math.PI,!0),t.closePath(),t.fill())}},isPointSelect:function(t,e){for(var o=0;o<this.pointLocationArr.length;o++){var n=this.pointLocationArr[o],i=Math.abs(n.X-t.elementX),r=Math.abs(n.Y-t.elementY);if(Math.pow(i*i+r*r,.5)<this.R){e.indexOf(o)<0&&e.push(o);break}}},initEvent:function(t,o,n){var i=this,r=[],a=!1;i._startHandler=function(t){t.point=event.changedTouches?event.changedTouches[0]:event,t.point.elementX=4*(t.point.pageX-d(n)),t.point.elementY=4*(t.point.pageY-p(n)),i.isPointSelect(t.point,r),a=!0},t.on(c,i._startHandler,!1),i._moveHanlder=function(t){if(a){t.preventDefault(),t.point=event.changedTouches?event.changedTouches[0]:event,t.point.elementX=4*(t.point.pageX-d(n)),t.point.elementY=4*(t.point.pageY-p(n));var e=t.point;i.isPointSelect(e,r),o.clearRect(0,0,i.CW,i.CH),i.draw(o,i.pointLocationArr,r,{X:e.elementX,Y:e.elementY})}},t.on(s,i._moveHanlder,!1),i._endHandler=function(t){t.point=event.changedTouches?event.changedTouches[0]:event,t.point.elementX=4*(t.point.pageX-d(n)),t.point.elementY=4*(t.point.pageY-p(n)),o.clearRect(0,0,i.CW,i.CH),i.draw(o,i.pointLocationArr,r,null);var e={sender:i,points:r};i.options.callback(e),l.trigger(i.holder,"done",e),a=!(r=[])},t.on(h,i._endHandler,!1)},pointLocationArr:[],clear:function(){var t=this;t.cxt&&(t.cxt.clearRect(0,0,t.CW,t.CH),t.draw(t.cxt,t.pointLocationArr,[],{X:0,Y:0}))},dispose:function(){var t=this;t.cxt=null,t.canvas.off(c,t._startHandler),t.canvas.off(s,t._moveHandler),t.canvas.off(h,t._endHandler),t.holder.innerHTML="",t.canvas=null}});l.fn.locker=function(t){return this.each(function(t,e){if(n)new i(e,n);else{var o=e.getAttribute("data-locker-options"),n=o?JSON.parse(o):{};n.lineColor=e.getAttribute("data-locker-line-color")||n.lineColor,n.ringColor=e.getAttribute("data-locker-ring-color")||n.ringColor,n.fillColor=e.getAttribute("data-locker-fill-color")||n.fillColor,n.pointColor=e.getAttribute("data-locker-point-color")||n.pointColor,n.width=e.getAttribute("data-locker-width")||n.width,n.height=e.getAttribute("data-locker-height")||n.height,new i(e,n)}}),this};try{l("."+o).locker()}catch(t){}l.ready(function(){l("."+o).locker()})}(mui,document);